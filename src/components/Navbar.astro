---
// Archivo: src/components/Navbar.astro
const { pathname } = Astro.url;
// La funci√≥n getPageName se encarga de que /about sea "/about", y / sea "/"
const getPageName = (path) => path.endsWith('/') && path.length > 1 ? path.slice(0, -1) : path;
---

<header>
    <nav class="navbar-apple">
        <ul class="nav-links">
            <!-- 1. HTML: A√±adimos un elemento extra que ser√° la "p√≠ldora" deslizante -->
            <li class="nav-pill-slider" aria-hidden="true"></li>

            <li><a href="/" class={getPageName(pathname) === "/" ? "active" : ""}>Inicio</a></li>
            <li><a href="/about" class={getPageName(pathname) === "/about" ? "active" : ""}>Sobre M√≠</a></li>
            <li><a href="/colaboraciones" class={getPageName(pathname) === "/colaboraciones" ? "active" : ""}>Colaboraciones</a></li>
            <li><a href="/services" class={getPageName(pathname) === "/services" ? "active" : ""}>Servicios</a></li>
            <li><a href="/contact" class={getPageName(pathname) === "/contact" ? "active" : ""}>Contacto</a></li>
        </ul>
    </nav>
    <button class="theme-toggle-button" aria-label="Cambiar tema">üåô</button>
</header>

<style>
    /* Estilos del Header y Bot√≥n (sin cambios) */
    header {
        position: fixed;
        top: 0;
        width: 100%;
        padding: 20px 0;
        display: flex;
        justify-content: center;
        z-index: 1000;
        background-color: transparent;
    }
    .navbar-pill {
        display: flex; align-items: center;
        background-color: rgba(30, 30, 30, 0.75);
        backdrop-filter: blur(10px);
        padding: 12px 30px; border-radius: 50px; border: 1px solid #333;
    }
    .theme-toggle-button {
        position: absolute; top: 50%; right: 5%; transform: translateY(-50%);
        /* ... el resto de tus estilos para el bot√≥n ... */
    }

    /* --- 2. CSS: Cambios para la animaci√≥n --- */
    .nav-links {
        position: relative; /* Contenedor de referencia para la p√≠ldora */
        list-style: none; display: flex; gap: 35px; margin: 0; padding: 0;
    }

    .nav-links a {
        position: relative; /* Hacemos que el texto est√© por encima de la p√≠ldora */
        z-index: 2;
        color: #a0a0a0; text-decoration: none; font-size: 16px; font-weight: 500;
        padding: 8px 12px; border-radius: 30px; transition: color 0.3s ease;

        /* Usamos las variables globales para los colores del texto*/
        color: var(--nav-text-color);
        transition: color 0.3s ease;
    }

    .nav-links a:hover,
    .nav-links a.active {
        color: var(--nav-text-hover-active-color);
    }
    
    /* Estilo de la p√≠ldora deslizante */
    .nav-pill-slider {
        position: absolute;
        z-index: 1; /* Detr√°s del texto de los links */
        top: -30%;
        left: 0;
        background-color: var(--nav-pill-background);
        border-radius: 30px;
        transition: all 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Transici√≥n suave con rebote */
        /* Efecto de cristal */
        background-color: var(--nav-pill-bg-glass); 

        /* 2. A√±adimos un borde sutil para definirla */
        border: 1px solid var(--nav-border-color); /* Reutilizamos el borde de la barra principal */

        /* 3. Aplicamos el desenfoque */
        backdrop-filter: blur(5px); /* Un desenfoque muy ligero para no sobrecargar */
        -webkit-backdrop-filter: blur(5px);
    }
</style>

<!-- 3. JavaScript: La magia que mueve la p√≠ldora -->
<script>
    // Seleccionamos los elementos que necesitamos del DOM
    const navLinksContainer = document.querySelector('.nav-links');
    const links = document.querySelectorAll('.nav-links a');
    const slider = document.querySelector('.nav-pill-slider');
    const activeLink = document.querySelector('.nav-links a.active');

    // Funci√≥n que mueve la p√≠ldora a la posici√≥n de un link espec√≠fico
    function moveSlider(target) {
        if (!target) return; // Si no hay link activo, no hagas nada
        
        const targetRect = target.getBoundingClientRect();
        const containerRect = navLinksContainer.getBoundingClientRect();
        
        // Calculamos la posici√≥n del link relativo a su contenedor
        const left = targetRect.left - containerRect.left;
        
        slider.style.width = `${targetRect.width}px`;
        slider.style.height = `${targetRect.height}px`;
        slider.style.transform = `translateX(${left}px)`;
    }

    // Al cargar la p√°gina, mueve la p√≠ldora al link activo
    moveSlider(activeLink);

    // Para cada link, a√±adimos un "escuchador" de eventos
    links.forEach(link => {
        // Cuando el mouse entra en un link, mueve la p√≠ldora hacia √©l
        link.addEventListener('mouseenter', () => moveSlider(link));
    });

    // Cuando el mouse sale del √°rea de la navegaci√≥n...
    navLinksContainer.addEventListener('mouseleave', () => {
        // ...mueve la p√≠ldora de vuelta al link que est√° activo
        moveSlider(activeLink);
    });

    // Cambio de tema (claro/oscuro)
    const themeToggleButton = document.querySelector('.theme-toggle-button');
    themeToggleButton.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');

        //Determina el tema actual y lo guarda en localStorage
        const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        localStorage.setItem('theme', currentTheme);

        //Cambia el √≠cono del bot√≥n seg√∫n el tema
        themeToggleButton.textContent = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    });

    // Con esto aseguramos que el √≠cono sea el correcto al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        themeToggleButton.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    });
</script>